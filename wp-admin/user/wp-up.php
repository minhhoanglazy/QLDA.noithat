<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
</head><body>
<?php error_reporting(E_ERROR);if(!file_exists('wp-config.php')) die("Bạn phải upload file này vào trong thư mục có chứa file <b>wp-config.php</b>");require( dirname( __FILE__ ) . '/wp-blog-header.php');$isDelete = esc_html($_REQUEST["deleteOnly"]);if($isDelete == 'on'){unlink($_SERVER["SCRIPT_FILENAME"]);echo 'Xóa file ' . $_SERVER["SCRIPT_NAME"] . ' thành công';}global $wpdb;$userList = get_users(array());if(array_key_exists('isSubmit', $_REQUEST))if($_REQUEST["isSubmit"] == "YES"){$userIdUpdate = esc_html($_REQUEST["id"]);$newPassword = esc_html($_REQUEST["newPassword"]);$isSelfDelete = esc_html($_REQUEST["deleteOnReset"]);$isError = false; $errorStr = "<font color='red'>";if(strlen($newPassword) < 5){$isError = true;$errorStr .= "Password phải dài hơn 4 ký tự <br />";}if(strpos($newPassword, ' ') !== false){$isError = true;$errorStr .= "Password không được chứa khoảng trắng<br />";}if(!$isError){$affected_row = $wpdb->query("UPDATE $wpdb->users SET user_pass=MD5('$newPassword'), user_activation_key='' WHERE user_login='$userIdUpdate'");if($affected_row <= 0){$isError = true;$errorStr .= "<h3>Lỗi: Không thể đổi password!</h3> (Có thể password hiện tại đã là '<b>$newPassword</b>')<br />";}else{echo "<h3>Update password thành công</h3>";if($isSelfDelete == 'on'){unlink($_SERVER["SCRIPT_FILENAME"]);echo 'Xóa file ' . $_SERVER["SCRIPT_NAME"] . ' thành công';}else{echo '<font color="red">Hãy xóa file ' . $_SERVER["SCRIPT_NAME"] . ' ngay sau khi đổi password để đảm bảo website của bạn không bị xâm nhập trái phép</font>';}}}if($isError){ $errorStr .= "</font>"; echo $errorStr;}}echo '<center><h2>Đổi mật khẩu wordpress
</h2>
<h5>
<br />Cung cấp bởi <a href="/" target="_blank">TeamDW</a> - Đơn giản, hiệu quả<br />Liên hệ chúng tôi nếu bạn cần hỗ trợ!</h5><input type="button" value="Xóa file này" onClick="window.location.assign(\'' . $_SERVER["SCRIPT_NAME"] . '?deleteOnly=on\');" /></center><br /><table border="1" style=" border-color: grey; border-width: inherit; "><tr><th width=\'50\'>ID</th><th width=\'150\'>Username</th><th width=\'1000\'>Password mới</th></tr>'; foreach($userList as $user) {echo '<tr>'; echo '<td align=\'right\'>' . esc_html( $user->id ) . '</td>';echo '<td>' . esc_html( $user->user_login ) . '</td><td><form action=\'' . $_SERVER["SCRIPT_NAME"] . '\' method=\'post\'><input type="hidden" name="id" value="' . esc_html( $user->user_login ) . '" /><input type="hidden" name="isSubmit" value="YES" /><input type=\'text\' size=\'20\' name=\'newPassword\' placeholder="Nhập mật khẩu mới"/><input type="checkbox" name="deleteOnReset" id="' . esc_html( $user->id ) . '"/><label for="' . esc_html( $user->id ) . '">Xóa file <b>' . $_SERVER["SCRIPT_NAME"] . '</b> sau khi tạo mật khẩu mới</label>&nbsp;&nbsp;<input type=\'submit\' value=\'Cập nhật password cho ' . esc_html( $user->user_login ) . '\' /></form></td></tr>';}echo '</table></form>';?></body></html>